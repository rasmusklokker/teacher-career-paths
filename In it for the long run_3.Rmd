---
title: "In it for the long run"
author: "Rasmus H. Klokker"
date: "`r Sys.Date()`"
header-includes:
   - \usepackage{longtable}
   - \usepackage{booktabs}
   - \usepackage{graphicx}
   - \usepackage{float}
   - \usepackage{setspace}\onehalfspacing
output:
  bookdown::pdf_document2:
    toc: false
    keep_tex: true
bibliography: tchr_career_lit_2.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning = FALSE, fig.pos = "H", out.extra = "")

library(reshape2)
library(ggplot2)
library(ggstance)

theme_set(theme_minimal(base_size = 10, base_family = "serif") + theme(
  axis.line = element_line(color = "black"),
  plot.background = element_blank(),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.border = element_blank()
))





```

# Introduction

Teachers are the cornerstone of the educational system, making retention and attraction of teachers important to schools and governing bodies. Understanding teacher career paths can provide critical insights into the factors that influence teacher retention, professional development, and overall job satisfaction. Such knowledge can help policymakers and stakeholders who aim to improve educational outcomes and ensure a stable and effective teaching workforce.

Research on teacher career choices is intrinsically linked to issues of educational inequality. Teachers' decisions regarding where to work, whether to stay in the profession, and how to advance their careers can exacerbate or alleviate disparities in educational opportunities[@GLASSOW2023101255]. For instance, schools in low-income or rural areas often face higher turnover rates, leading to a lack of experienced and qualified teachers in these communities[@doi:10.1177/0013161X231159922]. This turnover can result in a cycle of educational disadvantage, where students in underprivileged areas receive lower-quality education than their peers in more affluent regions[@sass2012value]. Moreover, teacher career paths are influenced by various factors such as working conditions, support systems, and professional development opportunities, which are often unevenly distributed across different schools and districts. Schools serving disadvantaged populations frequently lack the resources to provide the necessary support for teacher growth and retention, further perpetuating educational inequality[@nguyen2020correlates]

In this paper, I will study patterns of teacher career paths using sequence analysis. Sequence analysis is a descriptive method, characterized by visual summaries of sequences. Thus sequence analysis allows for a more "holistic" summary of teachers' career paths, opposed to e.g. tables showing transition rates between possible teacher career decisions or regression models where teacher career decisions in previous periods are used to predict career decisions in the current period. Subsequently, I will use cluster analysis to form types of teacher career paths and investigate if teacher career paths can be segmented by teachers' choices to work in schools characterized by serving students of different socioeconomic status(SES). Lastly, i will investigate how teacher characteristics, such as teacher credentials, are associated with different types of teacher career paths.

Crucially, using high-quality Danish register data, I am able to follow cohorts of teacher graduates from the year of graduation onwards. Given that the earliest observed cohort graduated in 1980, I am able to investigate the career paths of more than 20000 teachers across more than three decades, enabling me to map out the full career paths of the earliest teacher cohorts.


While scholarly literature on teacher career choices has emerged, particularly within the literature on teacher sorting, knowledge on teacher career paths that span long time horizons is still minimal. As such, knowledge of teacher career paths does, in many cases, concern partial teacher careers rather than the entire careers of teachers, spanning entry to the labor market all the way to retirement. 


Thus, this paper will primarily contribute by expanding our knowledge on the late stages of teacher career paths. This includes the transitions from mid- to late-stage careers as well as how patterns of late-stage teacher careers compare to the early- and mid-stage teacher careers. Crucially, this will also contribute knowledge on the timing of teachers who opt out of teaching. If there exists a non-trivial share of teachers who opt out of teaching in the later stages of their career, earlier studies on teacher careers, and particularly teacher attrition, may underestimate the share of teachers who opt out of teaching. If, however, teachers who opt out of teaching in the earlier stages of their careers choose to enter teaching again later in their careers, previous studies could have overestimated the share of teachers who opt out of teaching indefinitely. Such knowledge is informative on issues such as teacher shortage, as an overview of how teachers opt out of, or back into, teaching can reveal whether teachers opting out of teaching are "replenished" by returning teachers, or if teachers leaving the profession are contributing to teacher shortages. Further, the results will contribute to our knowledge on how teachers sort between schools serving different student populations as well as how this type of sorting is associated with teacher characteristics. While the literature on teacher sorting points to student SES background as predictive of teacher retention and attrition, studies rarely investigate this from a perspective that involves teacher career decisions across very long time spans, as is the case here. As such, the results in this paper can inform whether teachers are more likely to gravitate towards schools serving students from affluent backgrounds at the beginning of their career, of this phenomena occurs later in teachers' career, which may suggest that such changes are the result of burnout. 

<!-- WE KNOW THIS.... -->

<!-- HOWEVER WE DON'T KNOW.... -->

<!-- AND THIS I'LL INVESTIGATE -->



<!-- Teacher career paths may impact educational inequality, if teachers in general avoid schools with academically low-performing students. -->
<!-- This is especially so if teachers with better credentials or experience are more prone to avoid such schools than the average teacher. -->


<!-- This paper primarily contributes to the current literature on teacher carreer paths by being able to follow the carreer paths of teachers across several decades, up to 40 years. As such, the analyses in this paper are uniquely able to the long-term perspective of teacher careers, e.g. whether 15 years or more, of teaching experience, represents a threshold where teachers are the least prone to get a job at school serving academically low-performing students or if teacher career paths follow stable patterns "from the cradle to the grave" -->



In this paper, I will follow two overarching research questions.

1) How can individual teacher career choices be segmented to form distinct types of teacher career paths?

2) How are teacher characteristics associated with distinct types of teacher career paths?

Here, teacher career paths are defined as _a sequence of consecutive career decisions, e.g. switching employment from one school to the next or switching to employment outside of public primary school, ordered in time from the time of graduation to the time of retirement_. As such, a teacher career path comprises the entire history of a teachers' career decisions from the time of graduation to retirement. 


In this paper, I find that more than 50% of teacher graduates work outside public primary schools. Further, I find that teacher career paths can be divided into four general types of career paths:


1) "Leavers" - A type of career path in which teachers almost exclusively work outside public primary schools.

2) "Teaching the marginalized " - A type of career path in which teachers primarily work in schools that serve less affluent students

3) "Teaching the affluent" - A type of career path in which teachers primarily work in schools that serve the most affluent students

4) "All-round teachers" - A type of career path in which teachers primarily work in schools that serve middle-class students

Lastly, I find that teacher characteristics, measured at graduation, are very poor predictors of which career path teachers choose to follow.

## State of the art

This section will outline the current scholarly literature on teacher careers. The results from this literature will be used to guide the choices concerning the definition of school types and which teacher characteristics to focus on in the empirical analysis. 

## What do we know about how teachers change jobs throughout their careers?

Few studies provide broad overviews of teacher career paths. In @gubler2017apple, we find the most broad overview. The authors find six different types of career paths. The majority of teachers start as primary school teachers before transitioning to childcare and part-time work as public school teachers. The second most frequent career path type involves teachers with stable employment in primary school teaching across the entire period. While the study of @gubler2017apple is closely related to this paper regarding the method and overall research goal, there are some key differences. Firstly, while the authors construct overall patterns of teacher careers using sequence analysis, the authors do not focus on transitions between schools serving different types of students, e.g., low- and high-SES students. Secondly, while the study can track teachers across a relatively long period (15 years), the sample size is limited to 999 teachers.
@lindqvist2014teacher uses, like @gubler2017apple and this paper, sequence analysis to study teacher career paths. @lindqvist2014teacher find that 85% of newly graduated teachers works as teachers, which rises to 94% after two years after graduation. From thereon, there is a trend of attrition in which teachers opt out of teaching which flattens at 15 years after graduation, where 67% of teachers still work as teachers. While @lindqvist2014teacher are able to follow teachers up to 18 years after graduation, the sample is limited to 87 teachers. Secondly, the study is limited to 3 types of career decisions, working as a teacher, not working as a teacher or parental leave.


The remaining literature on teacher career paths focuses on more specific elements of teacher career choices or is more loosely related to research questions on teacher career paths.

For instance, @falch2022teacher, @goldhaber2022lost, and @boyd2002initial all focus on the early careers of teachers. For @falch2022teacher and @boyd2002initial, the focus is specifically on teacher attrition. @falch2022teacher finds that attrition from teaching positions increases steadily as teachers gain experience and that teachers mainly pursue occupations outside teaching. Further, attrition was higher among teachers with higher degrees of academic ability, which is also among the results of @boyd2002initial. @goldhaber2022lost found similar results regarding attrition but also found that a substantial proportion of newly graduated teachers enter employment outside public primary schools before transitioning to teaching positions.

There is extensive scholarly literature that does not directly address teacher career paths. However, many of the results in this literature are relevant to the present paper, especially regarding how school and teacher characteristics impact teachers' decisions to stay at or leave the school where they are currently employed.


## What do we know about how teachers change jobs between schools that serve different kinds of students?
While the remaining literature does not directly address how teacher characteristics, such as qualifications, skills, gender or age, impact teacher career paths, the literature on teacher retention and attrition is highly informative on which characteristics of schools and teachers are predictive of teacher retention or teacher attrition. In this paper i will use previous results from this literature to inform the construction of school types that form part of teachers career decisions present in data as well as which characteristics of teachers that may prove viable predictors of teachers career paths.

There is considerable literature on how school characteristics, e.g., the composition of the student body, the school's physical environment, the work environment, the quality of school leadership, etc., impact teacher attrition and retention. Three comprehensive literature reviews,@guarino2006teacher, @borman2008teacher, and @nguyen2020correlates, summarize this literature. However, @nguyen2020correlates is the most recent review and encompasses the studies included in the previous reviews. In @nguyen2020correlates higher degrees of student disciplinary problems are the third highest effect size among the factors that increase attrition while factors such as improved work environment, providing induction/mentoring to newly hired teachers, opportunities for professional development, and administrative support reduce attrition.
Interestingly, student body characteristics do not seem to impact teacher attrition to any discernible degree. Only the estimated effect of student poverty is of noticeable size. However, while the results in @nguyen2020correlates gives an excellent overview of the impact of school characteristics in isolation, other studies point to factors such as better working environments, which are important predictors of teacher retention, are correlated with student body composition[@hanushek2004revolving; @matsuoka2015school]. As such, results suggest that student background is not itself a strong predictor of teacher attrition, but rather that schools serving marginalized students have poor working environments. 

```{r load review data}

review.dat <- read.csv(file="C:/Users/B059064/Desktop/PHD/reformkommision oplæg/reviews_results.csv", sep=";")


```




```{r process review data}

review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")] <- apply(review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")],2,
                                                                       function(x){gsub("[a-z]", "",x)})

review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")] <- apply(review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")],2, as.numeric)

review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")] <- apply(review.dat[c("Log.odds.ratio", "Lower.bound", "Upper.bound")],2, exp)


```

```{r compare effs, fig.cap= "Associations between leaving the teaching profession and school characteristics - reproduced from Nguyen, 2020", fig.width=13, fig.asp=1.4, out.width= "100%", eval=FALSE}

ind <- which(review.dat$predictor.category %in% c("Student Body Characteristics", "School Organizational Characteristics", 
                                                          "School Resources")&
                         !is.na(review.dat$Lower.bound)&
                         review.dat$review %in% "Nguyen")

review.dat$Log.odds.ratio <- log(review.dat$Log.odds.ratio)

review.dat_red <- review.dat[ind,]

#head(review.dat_red[order(-abs(review.dat_red$Log.odds.ratio)),])

# comp_dat <- rbind(review.dat[ind,c("Factor", "Log.odds.ratio", "review")], 
#                   data.frame(Factor=names(eff_sizes$es),Log.odds.ratio=-1*eff_sizes$es, review= "TTCDID"))
# 
# comp_dat$rank <-rank(-abs(comp_dat$Log.odds.ratio))



# p <- ggplot(review.dat[ind,], aes(x=Log.odds.ratio, y=reorder(Factor, Log.odds.ratio)))
# p <- p+geom_point(position=ggstance::position_dodgev(height=0.6))
# p <- p+geom_errorbarh(aes(xmin=log(Lower.bound), xmax=log(Upper.bound)), position=ggstance::position_dodgev(height=0.6))
# p <- p+geom_vline(xintercept = 0, linetype="dashed")
# p <- p+facet_wrap(~predictor.category, scales="free",ncol = 1)
# p <- p+labs(x="odds ratio of leaving teaching profession", y="School characteristic")
# p <- p+xlim(-1,1)
# p <- p+theme(text = element_text(size=16, face="bold"),  plot.margin=unit(c(0,0,0,0), "null"))

p <- ggplot(review.dat[ind,], aes(x=Log.odds.ratio, y=reorder(Factor, Log.odds.ratio), color=predictor.category))
p <- p+geom_point(position=ggstance::position_dodgev(height=0.6))
p <- p+geom_errorbarh(aes(xmin=log(Lower.bound), xmax=log(Upper.bound)), position=ggstance::position_dodgev(height=0.6))
p <- p+geom_vline(xintercept = 0, linetype="dashed")
#p <- p+facet_wrap(~predictor.category, scales="free",ncol = 1)
p <- p+labs(x="odds ratio of leaving teaching profession", y="School characteristic")
#p <- p+xlim(-1.5,1.5)
p <- p+theme(text = element_text(size=16, face="bold"),  plot.margin=unit(c(0,0,0,0), "null"))


#ggsave('schoolchars.png', p)
#
#
#knitr::include_graphics("schoolchars.png")

p
# 
# abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "Nguyen"&comp_dat$Factor %in% "Better work environment "])/max(abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "TTCDID"]))
# 
# round(abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "Nguyen"&comp_dat$Factor %in% "Administrative support "])/abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "TTCDID"&comp_dat$Factor %in% "newgrad_teacher_share"]),2)

```



## What do we know about how teacher characteristics impact career choices?

Regarding teacher characteristics, the estimated effect of having more than three years of experience and  having a professional specialization both increase the odds of teacher attrition. Interestingly, having better test scores, e.g., SAT scores, has a negligible effect on attrition of teachers. On the other end of the spectrum, having more children and having a teacher certification, having a full-time teaching position, being in the Hispanic minority group, and being older than 28 years of age all reduces the odds of attrition considerably. 


```{r compare effs teacher chars, fig.cap= "Associations between leaving the teaching profession and teacher characteristics - reproduced from Nguyen, 2020", fig.width=13, fig.asp=1.4, out.width= "100%", eval=FALSE}

ind <- which(review.dat$predictor.category %in% c("Teacher Characteristics ", "Teacher Qualifications")&
                         !is.na(review.dat$Lower.bound)&
                         review.dat$review %in% "Nguyen")



review.dat_red <- review.dat[ind,]

head(review.dat_red[order(-abs(review.dat_red$Log.odds.ratio)),])

# comp_dat <- rbind(review.dat[ind,c("Factor", "Log.odds.ratio", "review")], 
#                   data.frame(Factor=names(eff_sizes$es),Log.odds.ratio=-1*eff_sizes$es, review= "TTCDID"))
# 
# comp_dat$rank <-rank(-abs(comp_dat$Log.odds.ratio))



# p <- ggplot(review.dat[ind,], aes(x=Log.odds.ratio, y=reorder(Factor, Log.odds.ratio)))
# p <- p+geom_point(position=ggstance::position_dodgev(height=0.6))
# p <- p+geom_errorbarh(aes(xmin=log(Lower.bound), xmax=log(Upper.bound)), position=ggstance::position_dodgev(height=0.6))
# p <- p+geom_vline(xintercept = 0, linetype="dashed")
# p <- p+facet_wrap(~predictor.category, scales="free",ncol = 1)
# p <- p+labs(x="odds ratio of leaving teaching profession", y="School characteristic")
# p <- p+xlim(-1,1)
# p <- p+theme(text = element_text(size=16, face="bold"),  plot.margin=unit(c(0,0,0,0), "null"))

p <- ggplot(review.dat[ind,], aes(x=Log.odds.ratio, y=reorder(Factor, Log.odds.ratio), color=predictor.category))
#p <- p+geom_point(position=ggstance::position_dodgev(height=0.6))
p <- p+geom_point()
p <- p+geom_errorbarh(aes(xmin=log(Lower.bound), xmax=log(Upper.bound)), position=ggstance::position_dodgev(height=0.6))
p <- p+geom_vline(xintercept = 0, linetype="dashed")
#p <- p+facet_wrap(~predictor.category, scales="free",ncol = 1)
p <- p+labs(x="odds ratio of leaving teaching profession", y="School characteristic")
#p <- p+xlim(-1.5,1.5)
p <- p+theme(text = element_text(size=16, face="bold"),  plot.margin=unit(c(0,0,0,0), "null"))


#ggsave('schoolchars.png', p)
#
#
#knitr::include_graphics("schoolchars.png")

p
# 
# abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "Nguyen"&comp_dat$Factor %in% "Better work environment "])/max(abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "TTCDID"]))
# 
# round(abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "Nguyen"&comp_dat$Factor %in% "Administrative support "])/abs(comp_dat$Log.odds.ratio[comp_dat$review %in% "TTCDID"&comp_dat$Factor %in% "newgrad_teacher_share"]),2)

```

As we can see, the scholarly literature suggests that several characteristics of both schools and teachers impact the attrition and retention of teachers and, thereby, also the career choices of teachers. Interestingly, most student body characteristics and indicators of teacher ability are not among the most impactful of these characteristics. However, it should be noted that the results in @nguyen2020correlates pertain to leaving or staying in the current job, and not the entire career paths of teachers. As such, the results of @nguyen2020correlates cannot overrule choices concerning the analysis of data that are founded in the theoretical framework of this paper.




# Theory

In this paper, I chose to lean heavily on Carol Rinke's work as the basis of the theoretical framework. Rinke's work focuses on the dynamic process of how teachers shape their professional identity and how this process impacts teachers' career decisions. I will use the work of Rinke to construct a theoretical framework that will serve to, in conjunction with scholarly literature, guide choices in the analysis of data as well as the interpretation of results. As such, the theoretical framework aims to give a mechanistic explanation of how and why we would expect teachers' career decisions to evolve during the course of their career and how the sum of these career choices will form teacher career paths. 

```{tikz, dag, eval=FALSE}

\begin{tikzpicture}[scale=25]
\node (v0) at (0.182,-0.194) {experiences prior to graduating};
\node (v1) at (0.186,-0.440) {$Career decision_graduation$};
\node (v2) at (0.180,-0.300) {$Professional identity_graduation$};
\node (v3) at (0.413,-0.437) {$Career decision_t1$};
\node (v4) at (0.334,-0.181) {$Work context_T1$};
\node (v5) at (0.484,-0.177) {$experiences_T1$};
\node (v6) at (0.409,-0.304) {$professional identity_T1$};
\node (v7) at (0.630,-0.174) {$Work context_T2$};
\node (v8) at (0.789,-0.169) {$Experiences_T2$};
\node (v9) at (0.710,-0.300) {$Professional identity_T2$};
\node (v10) at (0.713,-0.435) {$Career decision_T2$};
\draw [->] (v0) edge (v2);
\draw [->] (v2) edge (v1);
\draw [->] (v1) edge (v4);
\draw [->] (v4) edge (v6);
\draw [->] (v5) edge (v6);
\draw [->] (v6) edge (v3);
\draw [->] (v0) edge (v6);
\draw [->] (v3) edge (v7);
\draw [->] (v7) edge (v9);
\draw [->] (v8) edge (v9);
\draw [->] (v5) edge (v9);
\draw [->] (v0) edge (v9);
\draw [->] (v9) edge (v10);
\end{tikzpicture}

```



## What shapes the preferences of teachers?

Teachers' professional identity is likely to form the backbone of teachers' preferences towards the kind of school they want to work in or whether they would prefer to opt out of teaching altogether. Teachers' professional identity comprises their aspirations, values, and how they explain their decisions and actions[@Forde_McMahon_2019]. Previous studies highlight the importance of teachers' understanding of themselves and how they use their professional identity to make sense of themselves as teachers. As such, teachers' professional identities likely guide how they make choices in terms of their careers and how they relate to colleagues, students, and their everyday practice as teachers.[@Rinke_2008]

Importantly, teachers' professional identities are not immutable but result from a dynamic process that constructs and alters their professional identity during their careers [@Rinke_2014]. Personal experience, professional practice, and the external environment all interact to shape teachers' professional identities. While some constituents of teachers' professional identity, e.g., experiences during childhood and adolescence, moral values, and experiences during education, are solid and lasting components of teachers' professional identity, other components, e.g. professional practice, interactions with other teachers and students in different schooling context, are likely to contribute to the dynamic nature of teachers' professional identity[@Rinke_2014]. "external" factors, e.g., family formation, sickness, are also likely contributors to teachers' professional identity outside their experiences in schools[@Attard_Tonna_Calleja_2023]

As such, teachers' career choices can be seen as the consequence of the ongoing construction of their professional identity.



## What makes some schools more attractive than others?

The attractiveness of some schools, as opposed to others, is not arbitrary. This is highlighted in the work of @ingersoll2001teacher, who points to the organizational features of schools as prominent "push-and-pull" factors for teachers.

The organizational features cover characteristics such as employee
compensation structure, administrative support, degree of conflict, and
strife, and employee influence over the organization
policies[@ingersoll2001teacher]. Ingersoll's central premise is that these
factors impact, e.g., the cohesion among teachers and professional
motivation and thus influence how likely teachers are to stay at or
leave schools. Further, Ingersoll argues that schools faced with
external challenges, such as difficulties in hiring teachers due to being
located in a deprived neighborhood, are forced to decrease
organizational standards. For instance, principals facing trouble
attracting teachers specialized in teaching biology may assign teachers
with no specialization in biology to teach biology classes

Such organizational features are also present in Rinke's work and are often conceptualized as "extrinsic factors." Rinke's study highlights that teachers actively evaluate their professional direction based on their identities and the alignment of their values with their work environment. For instance, teachers who feel a strong emotional connection to their workplace are more likely to remain in the profession, while those whose experiences contradict their ethical beliefs may choose to leave[@Rinke_Mawhinney_2017]


## Why do teachers change from one school to another?

The decision to leave one school in favor of another depends on the interplay between life experiences and the school context.

Working conditions and life experiences interact to form the picture of what success looks like to the teacher, and thus ultimately decide the career choice of the teacher[@Rinke_2014]. This choice, life experiences, and previous work experiences contribute to the ongoing construction of teachers' professional identities, which they will draw on to make future career decisions. In the framework of Rinke, this interaction is depicted as a process of negotiation, in which experiences in the workplace context are "filtered" by teachers' life experiences. Past experiences, e.g., personal and moral values, formative experiences during childhood and adolescence, and experiences throughout education and former workplaces, work as filters that aid the interpretation and management of experiences and challenges that teachers are exposed to in schools. It is in this negotiation between life experiences and experiences at the current workplace that teachers construct their perception of success[@Rinke_2014]

As such, the decision to leave the current school in favor of another school occurs when the current perception of success does not align with the current work situation. One may imagine that a teacher aspires to make a difference for underprivileged students but is currently employed in a school of relatively affluent students. In such a situation, the current work context is not well aligned with the teachers' current perception of success. 
In another situation, one may imagine a teacher with a background in STEM who has trouble sustaining themselves economically on a teacher's salary. At the same time, the teacher is disillusioned by feeling unprepared to teach primary school students and thus finds it very difficult to make the positive change the teacher had hoped to make when beginning a career as a teacher. In such a situation, the current perception of success would likely be to find employment in STEM for a higher salary and thus entirely leave teaching altogether.

<!-- personal development -->

<!-- life circumstances(marital status, children, moving) -->

<!-- ## Why do teachers opt out of teaching? -->

<!-- Disillusionment("what does it even matter"),  -->

<!-- burnout -->

<!-- discrepancy between expectations and reality -->

<!-- better "outside options"(e.g. physics teachers who can work in a lab)(Rinke, pusn and pull p. 372) -->

<!-- ## How do teacher characteristics impact teacher career choices? -->

<!-- Teachers with better credentials and more experienced teachers are more prone to get a job at schools with academically high-performing students -->

## Expected results

Applying the theoretical framework of Rinke leads to a range of theoretically informed expectations concerning teachers career paths.

* Career paths of teachers will vary between teachers due to the differences concerning professional identity

* Teachers' career paths will exhibit dynamic patterns, i.e., teachers will switch between schools and different types of schools, e.g., between schools serving different kinds of student populations or opting in and out of teaching. This is opposed to a more static pattern, where teachers only rarely will transition from the type of employment that they started in after graduating, or, in the most extreme case, being employed in the same job through their entire career. Dynamic patterns are expected due to the dynamic process shaping teachers' professional identities throughout their careers. The propensity to switch between schools, types of schools, or opting in and out of teaching is also expected to vary between teachers. As such, we would expect that e.g. teachers might be employed in one type of school in the early stages of their career and then transition to other types of schools, or opt out of teaching,  in later stages of their career. Conversely, it would be unexpected to find that the distribution of teacher career decisions was largely the same across the course of teacher careers, i.e. that the shares of teachers working in each of type of school or that had opted out of teaching would be the same across all years after graduation.

* Teacher career paths will comprised of a smaller set of different types of career paths. Teachers who share experiences or have had similar experiences, e.g., having had similar types of childhoods, or similar experiences within the educational system or sharing characteristics such as gender, ethnic origin, or geographic origin, will likely also share aspects of their professional identity. As such, it is expected that teachers with similar experiences or characteristics will have similar career paths, and these similarities in career paths can be used to segment teacher career paths into types of teacher career paths.

* Characteristics of teachers will be associated with different types of career paths. While past experiences and personal characteristics feature prominently in Rinke's work, there are no precise and coherent descriptions of how specific experiences or characteristics would affect teacher career paths. Parts of her work, however, touch upon specific experiences and characteristics, chiefly teachers' educational background and educational performance. 

  * Teachers' Educational Performance: Teachers with strong educational performance or special credentials may have more career aspirations and opportunities outside of teaching, making them more likely to leave the profession or switch to schools with better resources and student demographics. Such teachers may also be influenced by societal perceptions that teaching undervalues their abilities, which can deter them from remaining in the field [@Rinke_2009; @Rinke_2014].
  
  * Gender:
  Gender influences teachers' career decisions through societal norms and expectations. Women face professional barriers due to gendered expectations surrounding unpaid labor and childcare, while men may experience social deterrence from entering or staying in teaching, as it is traditionally viewed as a female-dominated profession [@Biklen_1995; @Rinke_Mawhinney_2019].
  
  * Geographic Origin: Teachers often prefer to work close to their geographic origin, influencing their career paths. Those from rural areas are more likely to teach in similar locations, while teachers from urban or suburban areas are more likely to work in schools serving higher-SES student populations [@blaushild2023investigating; @boyd2005draw; @wei2020draw; @oecd2023].
  
  * Age: Older teachers who enter the profession from other careers or educational tracks may have clearer career goals and be more committed to teaching compared to younger teachers whose first professional experience is in education [@evans2011motivations].
  
  * Marital Status and Children: Marriage and having children influence teachers’ desire for career stability, often limiting their geographic mobility and occupational choices. These factors lead teachers to prioritize career stability and family considerations, which may result in less career movement [@nguyen2020correlates].
  
  

<!--   * Teachers' educational performance: In the work of Rinke, teachers with good educational performance or better/special credentials may show higher aspirations in terms of career. In particular, such teachers may have more employment opportunities outside teaching and thus be more inclined to leave teaching. As such, teachers with more opportunities outside teaching may also react more strongly to dissatisfactory work environments and may be more prone to switch to schools with better work environments or class environments where they can navigate more easily. As such, academically gifted or better-credentialed teachers may be more prone to switch to schools with better resources or schools serving more affluent student populations if they do not opt out of teaching entirely[@Rinke_2009]. Additionally, the comparatively low perceived status of teaching may also push the most academically able teachers out of teaching. Even if the teachers themselves may prefer teaching due to, e.g., moral values, teachers may not find support in their decision or even face resistance from their close ties who may purport the idea that academic ability is "wasted" on a career in teaching[@Rinke_2014] -->

<!--   * Gender: The teacher's gender likely impacts their career decisions. Given that gender has likely influenced previous life experiences and is a part of teachers' identity prior to their work as teachers, it is also likely that teachers' gender will impact their professional identity. However, the likely impact of gender on teachers' career decisions is unclear. Women face challenges in many professions due to gendered norms surrounding work, in which they are expected to, e.g., bear and care for children and bear the brunt of unpaid labor in the home. These gendered norms likely prevent women from participating in the labor market and advancing professionally [@Biklen_1995]. Concerning gendered norms in teaching, these may work against men's decision to either choose or stay in teaching, as teaching is traditionally seen as a profession associated with women. In that sense, male teachers may feel a cultural deterrence to choose or stay in teaching, as they are expected to choose a career more aligned with classical views of male occupations[@Rinke_Mawhinney_2019].  -->

<!--   * Geographic origin: While Rinke's work does not mention how geographic origin specifically impacts teachers' career decisions, it is mentioned as a part of the past experiences that shape teachers' professional identity. Previous studies have shown that teachers prefer to teach close to their geographic origin[@blaushild2023investigating; @boyd2005draw; @wei2020draw]. As such, teachers originating from, e.g., rural areas are likely more prone to find employment in the types of schools found in such areas. Given that individuals with either high amounts of economic resources or those with college degrees tend to live in or around metropolitan areas[@oecd2023], teachers from rural origins are likely less prone to be teaching in schools serving students with a high-SES background than teachers' from more urban or sub-urban origins. -->

<!--   <!-- * Socio-economic background: The socio-economic background of teachers may also impact teachers' career decisions. Specifically, teachers from affluent and, especially, highly educated homes may be perceived as engaging in "downward mobility" and "wasting" their opportunities(Dworkin, A. G. (1980). The changing demography of public schools teachers: Some implications for faculty turnover in urban areas.; Why half of teachers leave, John Rury (1989), ref in "why half leave"). Conversely, teachers from homes in which parents hold no college degrees may perceive the attainment of a position as a teacher as a perpetual success, in the framework of Rinke. For such teachers, current workplace situations may not fulfill their wishes, but remaining in teaching may be perceived as favorable compared to opting out, regardless of the current work environment. Teachers from more affluent backgrounds may however be more prone to perceive opting out of teaching to pursue other occupations as more aligned with their perception of success.  -->

<!-- Ethnic origin   -->

<!--   * Age: While most teachers' are similarly aged when they graduate, other teacher graduates may have opted into teaching from different occupations or educational tracks and will likely be older than their peers. Such teachers may have a more developed perception of success concerning careers than their peers due to previous experiences in, e.g., the labor market or other educational tracks. As a result, these teachers may be more determined and motivated to make a career out of teaching than their younger peers, whose first experiences in the labor market will be as teachers[@evans2011motivations]. -->

<!-- REF --> 

<!--   * Marital status and children: Marriage and children are events in teachers' personal lives that likely lead to a wish for more career stability. Married couples are likely to live or wish to live together, which means that decisions regarding residential location are now joint decisions of married couples. This likely restricts the geographic mobility of both individuals in the couple, which in turn restricts the choices of occupation in terms of geography. This restriction is further exacerbated by couples who are homeowners, as this adds additional economic restrictions, such as mortgage payments. Having children entails many of the same restrictions and demands for stability concerning residential location. In addition, caring for children adds additional constraints on parents' time and economic resources. Additionally, marriage and family formation likely add a dimension of fulfillment in teachers' lives, which likely impacts teachers' perception of success in their careers, e.g., teachers may wish to balance career decisions such that future career decisions will lead to improvement in terms of work context but do not negatively impact either teachers' marriage or family, e.g., by having to relocate. As such, marriage and having children likely lead to more stable career patterns[@nguyen2020correlates]. -->

  <!-- * Others -->
  

<!-- -Some will drop out, perhaps those that are the academically most able due to better outside-options -->

<!-- -Some will prefer schools and can find jobs  -->

<!-- - Variation across career paths is expected due to the dynamic process of constructing teachers' professional identity. -->

<!-- -Due to differences in identity between teachers, teachers will seek different career paths. Schools with different characteristics will appeal to teachers' with different types of professional identities. Teachers with similar types of professional identities will therefore attempt to find employment in the same type of schools, and will therefore have similar types of career paths when career paths are defined on the basis of different types of schools.  -->


<!-- - While Rinke stresses that school characteristics work as either push- or pull-factors in conjunction with intrinsic factors of teachers, e.g. personal values, beliefs and experiences, some school characteristics, e.g. student discipline problems, do seem to be a prominent push-factor, on average. As such, while differences between teachers, with regards to teachers' professional identity, may make some teachers more resilient towards student discipline problems, teachers do seem, on average, to prefer schools with lower amounts of student discipline problems.  -->


<!-- -Measurable teacher characteristics, e.g. teachers' sex, geographical origin, academic ability and social background are tied are expressions of and influences on teachers' professional identity will be predictive of teacher career paths -->

<!-- - Teachers own experience within the educational system shapes how filter workplace experiences when teaching(Rinke, the apprenticeship....) -->

# Data

I use Danish administrative data covering two populations: All graduates from teacher training colleges from 1980 to 2020 and all Danish primary school students and their parents from 1980 to 2020. 

In this paper, the population of teachers is further restricted. The population of Danish primary school teachers is restricted to only include teachers who graduated with a college degree in teaching in the years 1980-1985. I chose to limit the years of graduation to the years 1980-1985, as this would allow me to investigate teacher careers over the course of 35 years while also yielding a population of considerable size as well as allowing me to investigate how teacher career paths vary between cohorts of teacher college graduates. 

<!-- Secondly, The population is restricted to only include teachers with a college degree in teaching. Career paths for teachers with a college degree in teaching have a natural starting point: the year these teachers attained their degree in teaching. It is very hard to define a natural starting point for teachers who have not attained traditional qualifications as a teacher through a college degree. While one possible starting point might be the first job as a teacher, it is tough to precisely pinpoint when individuals were working as primary school teachers for the first time without having the entire labor market history of individuals. As data on labor market participation does not cover years earlier than 1980, it is very hard to precisely measure if individuals entered the labor market in 1980-1985, as the entire labor market history of most individuals in the labor market in 1980-1985 likely begins before 1980. I, therefore, chose to limit the population to teachers who had attained a college degree in teaching to work with a population that is well-defined and comprehensively covered in Danish administrative data. -->

In sum, the population of teachers in this paper covers teachers who graduated with a college degree in teaching between 1980 and 1985. The starting point of teachers' career sequences is defined by the year of graduation, and sequences extend to 35 years after graduation.

The population of students in primary schools from 1980 to 2020 and their parents is not restricted in any way. The data on students and their parents primarily serve to construct aggregated measures of students' SES background and educational attainment following primary school. Students are directly linked to schools in the Danish administrative data.

## Linking teachers and schools

While the link between teachers and their workplaces is obtained directly from Statistics Denmark, the link between workplaces and primary schools needs to be constructed to link teachers to schools in which they are employed. To link teachers and schools, public administrative data on all educational institutions is linked to administrative data concerning teachers' workplaces. The result is a combined dataset in which teachers are linked to the schools in which they are employed on a yearly basis through the link between teachers and their workplaces. The link between teachers' workplaces and primary schools is described in greater detail in Appendix XX. 



## Teachers' career sequences

In this paper, teachers' career paths are comprised of sequences of career decisions that are recorded on a yearly basis. Teachers' career decisions are categorized into two primary categories: Working in different types of public primary schools or not working in public primary schools. These two primary categories are divided into different sub-categories, detailed below.


### Types of public primary schools


In this paper, I categorize schools according to two indicators of students' SES and one indicator of students academic performance, which are listed below. 

  * Average education of parents at the school level, measured in months
  * Average disposable income of parents at the school level
  * Average high school enrollment rate: The proportion of students graduating in year $t$ that are enrolled in high school in year $t+1$

All school characteristics are time-varying, i.e., averages have been computed for each school $s$ in each year $t$

Parents' educational level and income provide measurements of the average SES background of students at each school. The proportion of students enrolled in high school in the following provides an indirect measurement of student academic ability and academic aspirations. In the literature on teacher retention and attrition, student SES background and academic ability are prominent factors that impact teachers' propensity to stay at or leave their current place of employment[@nguyen2020correlates]. For this reason, I expect teachers to transition between schools depending on the chosen characteristics.

### Constructing school types

In order to construct the different types of schools where teachers can be employed, I aggregate the characteristics of each school on a linear scale, in which I scale and take the row sum of the characteristics of each school

<!-- $$School\ characteristics\ scale_{st}=\sum_{k=1}^{k}{school\ characteristics_{kst}}$$ -->

All school characteristics are scaled within each year $t$, i.e., for each school characteristic, each value is scaled by the mean and standard deviation of the school characteristic within the current year instead of the mean and standard deviation across the entire sample. This is to avoid the scaling being dependent on trends in time that may be present for each of the characteristics. For instance, parental educational levels increased quite dramatically from 1980 to 2020. On average, the average length of mothers' education increased by nearly three years. Consequently, there would be very few schools in 1980 with a positive z-score on the length of mothers' education.

While this approach is simple compared to other approaches of constructing such a scale, e.g., factor analysis or principal components analysis(PCA), performing a principal components analysis on the school characteristics suggests that the variables are correlated in a highly unidimensional manner, with the first principal component accounting 72% of the variance among the chosen school characteristics. Results pertaining to the PCA of school characteristics is reported in appendix XX 


After having computed each school's scale scores, I divided schools into four groups.

1: Schools among the 0th and 25th percentile of the distribution of the "school characteristics scale."

2: Schools above the 25th percentile and, at maximum, the 50th percentile of the distribution of the "school characteristics scale."

3: Schools above the 50th percentile and, at maximum, the 75th percentile of the distribution of the "school characteristics scale."

4: Schools above the 75th percentile and, at maximum, the 100th percentile of the distribution of the "school characteristics scale."


### Career decisions outside public primary schools

Teachers are coded as working outside public primary schools if they cannot be linked to a public primary school through their workplace. Importantly, this does not mean they do not work as primary school teachers or in other teaching positions. Teachers can work in private primary schools or teaching positions in secondary education. Around 63% of Danish teacher college graduates worked in public primary schools in 2012, while 11% worked in private primary schools and 23% worked outside primary schools[@aeLreruddannedeArbejder]. 

<!-- Outside public primary schools, teachers can make X different career decision: -->

<!-- 1: Work in private primary schools -->

<!-- 2: Pursue post-graduate education -->

<!-- 3: Work in other education -->

<!-- 4: Work outside education -->

<!-- For detailed descriptions of how each of these categories are defined with respect to the administrative data, readers are referred to appendix XX  -->


## Teacher characteristics

In addition to investigating the distribution of teachers' career sequences, I will also investigate whether the characteristics of teachers are associated with the different types of teacher career sequences.

Following the theoretical framework, I will include the following teacher characteristics as predictors of membership in types of teacher career sequences.

Teachers' gender: A binary variable indicating whether teachers are registered as female or male in the Danish administrative data

Teachers' high-school GPA: A continuous variable measuring the overall high-school GPA of teachers. While it would have been more relevant to include the teachers' college GPA, teachers' college GPA is not covered in the danish administrative data earlier than 2004.

Number of children in household: A continuous, integer-valued variable measuring the number of children living in the household of the teacher

Teachers' marital status: A discrete variable indicating whether teachers are unmarried, married, or divorced.

Type of municipality: A discrete variable indicating whether the teacher lived in one of five types of municipality

1) Municipalities in the capital region

2) Municipalities in metropolitan areas

3) Municipalities in suburban areas

4) Municipalities in provincial areas

5) Municipalities in rural areas

Age at graduation: A continuous, integer-valued variable measuring the age of teachers in years at the time teachers attained their college degree in teaching.

Year of graduation: A discrete variable indicating in which year the teacher graduated

All covariates are measured at the time of graduation and are thus time-invariant. As such, teachers' marital status may change during their careers, but in this paper, teachers' marital status indicates the marital status of teachers in the same year that they attained their college degree in teaching. 
<!-- This choice may seem overly restrictive, but it is not trivial to include time-varying covariates in sequence analysis[@liao2022sequence] -->

# Methods



<!-- ## What are we trying to look at with sequence analysis? -->

<!-- E.g. "what is the estimand?" -->

<!-- We are interested in distribution(s) of teacher career paths -->

<!-- ### What is a teacher career trajectory? -->

<!-- A sequence of career choices for each teacher e.g.: -->

<!-- low-SES pub school -> medium SES pub school -> not teacher -> high SES pub school -->


<!-- ### What is a distribution of teacher career trajectory?  -->

<!-- a description of multiple teacher career paths -->

<!-- eg. -->

<!-- Trajectory 1: low-SES pub school -> medium SES pub school -> not teacher -> high SES pub school -->

<!-- Trajectory 2: low-SES pub school -> medium SES pub school -> high SES pub school -> high SES pub school -->

<!-- in period 1, 100% is low-SES pub school, in period 2 100% is medium SES pub school, in period 3 50% is not teacher and 50% is high SES pub school -->





## Sequence analysis

I will investigate sequences of teacher career decisions using sequence analysis. Sequence analysis aims to apply a more holistic and descriptive approach to, e.g., analysis of career decisions or transitions between life course events such as marriage, family formation, etc., as opposed to, e.g., regression approaches that aim to model the average probability of transition between one state to another[@halpin2019introduction]. In this paper, I will primarily use sequence analysis for three purposes. 

1) Investigating the overall distribution of teacher carer sequences

2) Constructing a typology of teacher careers by applying optimal matching and cluster analysis to teacher sequences

3) Investigating associations between teacher characteristics and membership of teacher career types

I will use the R package "TraMineR" to carry out much of the analysis[@traminer].

### Distribution of sequences

I construct sequences of teacher career decisions as consecutive teacher careers during the years 1-35 since graduation. For instance, a sequence of career decisions in the first five years since graduation may look like _school type 1->school type 1->school type 1->school type 3->school type 4_ for one teacher and may look like _school type 1->school type 2->school type 2->school type 4->school type 4_ for another teacher. Taken together across all teachers, we get a distribution of sequences, where we can asses the share of teachers in each type of career decision across years since graduation, e.g., in year two since graduation, 10% of teachers may be employed in school type 1, and 8% are employed in school type 2. In comparison, in year three, since graduation, 7% of teachers may be employed in school type 1, and 11% are employed in school type 2. 


<!-- will use the R package TraMineR(REF) -->

## How will sequences be clustered?

After constructing the sequences, I will investigate if similar sequences can be clustered together to form different types of career sequences. To do this, I will:

1) Measure the similarity between sequences of teacher career sequences using "optimal matching" [@abbott2000sequence]. I derive the costs for substitutions from the observed transition rates between states. The transition rates and associated substitution costs are reported in Appendix XX. Costs for insertion and deletion are kept at 1

2) Use hierarchical clustering to construct types of career sequences. Here, I will use the "Wards method" to form the clusters of career paths[@ward1963hierarchical]. To find the optimal number of clusters, I will assess the fit of cluster solutions ranging between one and seven clusters. I will use the Average Silhouette Width(AWS), as this measure have several favorable properties, to measure how well each solution fits the data and select the solution with the best fit[@Studer_2013]. 



<!-- Additionally, i will use range of statistics describing the "fit" of the clustering procedure when the number of clusters vary. This is a data-driven procedure that aims to aid in deciding which number of clusters will lead to the "optimal" clustering of similar sequences of career decisions. -->

<!-- ## sequence similarity -->

<!-- The similarity of sequences is measured using optimal matching. Optimal matching attempts to align sequences such that they are identical using 3 different operations: Substitution, insertion and deletion. For each of these operations a "cost" assigned, which will ultimately determine how similar sequences are measured to be, following the optimal matching procedure. As an example we can see optimal matching would determine the similarity of the two previous sequences. -->

<!-- Sequence 1: school type 1 -> school type 1 -> school type 1 -> private school -> private school -->

<!-- Sequence 2: school type 1 -> school type 2 -> school type 2 -> school type 4 -> school type 4 -->

<!-- In this case 4 operations would be needed to align the sequences: -->

<!-- 1: substitute the second element in sequence 1, school type 1, for school type 2  -->

<!-- 2: substitute the third element in sequence 1, school type 1, for school type 2' -->

<!-- 3: substitute the fourth element in sequence 1, private school, for school type 4  -->

<!-- 4: substitute the fifth element in sequence 1, private school, for school type 4  -->

<!-- As such, the distance between sequence 1 and 2 is four operations according to OM -->

<!-- In the example above either of the three operations had the same "cost", which was 1. However insertions and deletions can be more or less costly than substitutions and not all substitutions need to have the same cost. For instance substituting school type 4 for school type 1 can be more costly than substituting school type 1 for school type 4.  -->

<!-- The costs for for substitutions,deletions and insertions can be set by the user following e.g. theoretical considerations. In this paper however, i have chosen a data-driven strategy for setting these costs, by relying on the inverse of the observed transition rates between states. As such, the substitution costs between states is given by -->

<!-- $SC(i,j) = cval - P(i|j) -P(j|i)$ -->

<!-- Where $i$ and $j$ represent states, while $P(i|j)$ and $P(j|i)$ is the probability of transitioning from state $i$ to $j$ and from state $j$ to $i$ respectively. $cval$ is a constant with the value of 2 -->

<!-- ## Hierarchical clustering -->

<!-- ChatGPT used here -->

<!-- Hierarchical clustering is a method used to group similar sequences into clusters based on their dissimilarity. It builds a hierarchy or a tree of clusters, known as a dendrogram, which can be cut at different levels to form various numbers of clusters.  -->

<!-- Briefly, hierarchical clustering iterates by merging observations into clusters until all observations belong to one single cluster. The process is depicted in figure \@ref(fig:clus-ex). In this paper i have chosen to use Wards method as the linkage criterion. -->

<!-- Clustering sequences using Ward linkage implies that, at each step the total within cluster variance is computed between each cluster, is an agglomerative hierarchical clustering technique that minimizes the total within-cluster variance. It does so by selecting the pair of clusters to merge at each step that leads to the smallest possible increase in the sum of squared differences within all clusters.  -->
<!-- At each step of the algorithm, Ward's method looks at all possible pairs of clusters and calculates how much the within-cluster variance would increase if those two clusters were merged. It then merges the two clusters that result in the smallest increase in variance. -->

<!-- $$\Delta(A,B)= \frac{n_An_B}{n_A+n_B} ||\overrightarrow{m}_A- \overrightarrow{m}_B||^2$$ -->

<!-- \begin{equation}  -->
<!--   \Delta(A,B)= \frac{n_An_B}{n_A+n_B} ||\overrightarrow{m}_A- \overrightarrow{m}_B||^2 -->
<!--   (\#eq:criter) -->
<!-- \end{equation} -->

<!-- Once the merger resulting in the smallest within-cluster variance has been identified, the distances between clusters are "updated" in the following manner: -->

<!-- Source Wikipedia -->

<!-- $$d^2_{PC} = \frac{n_A + n_P}{n_C + n_P} d^2_{PA} + \frac{n_B + n_P}{n_C + n_P} -->
<!--             d^2_{PB} - \frac{n_P}{n_C + n_P} d^2_{AB}$$ -->


<!-- \begin{equation}  -->
<!--   d^2_{PC} = \frac{n_A + n_P}{n_C + n_P} d^2_{PA} + \frac{n_B + n_P}{n_C + n_P} -->
<!--             d^2_{PB} - \frac{n_P}{n_C + n_P} d^2_{AB} -->
<!--   (\#eq:update) -->
<!-- \end{equation} -->

<!-- where $n_A$ and $n_B$ denote the number of sequences in clusters $A$ and $B$, which are the clusters that will be merged, $n_C$ denotes the number of sequences in the cluster resulting from the merge of clusters $A$ and $B$ and $n_P$ is the number of sequences in cluster $P$, which is a cluster that will not be included in the new cluster $C$ -->

<!-- To use figure \@ref(fig:clus-ex) as an example, we see that in step 1, the sequences $A$ and $B$ are merged into one cluster. In such a case, the distances to sequences $C$, $D$ and $E$ are updated following \ref{eq:update}, prior to merging sequences $A$ and $B$. As such, in step 2, the clustering process will have access to the distances between the cluster $AB$ and the sequences $C$, $D$ and $E$, rather than the distances between each of the individual sequences. -->



```{tikz, clus-ex, fig.cap="adapted from http://www.sthda.com/sthda/RDoc/images/hierarchical-clustering-agnes-diana.png", eval=FALSE}

\usetikzlibrary{arrows}
\usetikzlibrary{shapes}
\usetikzlibrary{matrix, positioning, calc}


\begin{tikzpicture}



% Agglomerative (AGNES) - blue
\draw[blue, thick, ->] (5,-0.4) -- (5,5.5);
\foreach \i in {0,1.5,3,4.5} {
    \node[anchor=south] at (5.5,\i-0.3) {Step $\pgfmathparse{floor(\i)}\pgfmathprintnumber\pgfmathresult$};
}


\draw [dashed] (0,-0.4) -- (5,-0.4);

\draw [dashed] (0,0.4) -- (5,0.4);

\draw [dashed] (0,1.1) -- (5,1.1);

\draw [dashed] (0,1.9) -- (5,1.9);

\draw [dashed] (0,2.6) -- (5,2.6);

\draw [dashed] (0,3.4) -- (5,3.4);

\draw [dashed] (0,4.1) -- (5,4.1);

\draw [dashed] (0,4.9) -- (5,4.9);


% Nodes and leaves
\node[draw, circle, fill=white] (a) at (0,0) {a};
\node[draw, circle, fill=white] (b) at (1,0) {b};
\node[draw, circle, fill=white] (c) at (2,0) {c};
\node[draw, circle, fill=white] (d) at (3,0) {d};
\node[draw, circle, fill=white] (e) at (4,0) {e};

\node[draw, ellipse, fill=white] (ab) at (0.5,1.5) {a b};
\node[draw, ellipse, fill=white] (de) at (3.5,1.5) {d e};
\node[draw, ellipse, fill=white] (cde) at (3,3) {c d e};
\node[draw, ellipse, fill=white] (abcde) at (1.75,4.5) {a b c d e};

% Edges
\draw[thick] (a) -- (ab);
\draw[thick] (b) -- (ab);
\draw[thick] (d) -- (de);
\draw[thick] (e) -- (de);
\draw[thick] (c) -- (cde);
\draw[thick] (de) -- (cde);
\draw[thick] (ab) -- (abcde);
\draw[thick] (cde) -- (abcde);

\end{tikzpicture}


```


<!-- ### Determining optimal number of clusters -->

<!-- As shown in figure \@ref(fig:clus-ex), the clustering process continues until all individual sequences are clustered into a single cluster, but it does not suggest at which step, the optimal clustering of sequences has been achieved. While, there is no clear consensus on how one decides which number of clusters will be "optimal" there are several measures that can aid the decision. In this paper i have chosen to apply the average silhouette width(ASW) as a measure of fit across solutions with different numbers of clusters, as this measure has several favorable properties. The silhouette width of each sequence can be though of a measure of well each sequence fits into the cluster to which it is assigned. Positive values of silhouette width indicates that a given sequence fits better into the cluster to which it is assigned than to the nearest "neighboring" cluster, i.e. the cluster in which the sequence would have the second best fit. Conversely, a negative value silhouette width indicates that the given sequence would actually fit better in the nearest neighboring cluster than the one to which it is currently assigned[@Studer_2013].  -->




## Predicting cluster membership using teacher characteristics


In this paper, I will investigate the association between a range of teacher characteristics and the types of career paths that teachers are assigned to via the clustering procedure. In order to account for unspecified non-linear functional forms, interactions between predictors, or other deviations from classical regression frameworks, I will apply flexible machine learning (ML) techniques, e.g. penalized regression estimators, spline-based regression estimators, tree-based ML techniques and ensembles of ML techniques such as random forest. Many of these techniques are known to "learn" the functional form of associations between outcomes and predictors from data. Additionally, tree-based techniques, such as decision trees, random forests, and gradient boosted trees, are known to also learn unspecified interactions between predictors[@James_Witten_Hastie_Tibshirani_2021]. I will also compare the predictive performance of the ML techniques with the performance of multinomial regression, which is the traditional estimation technique used to investigate relations between predictors and typologies of sequences[@liao2022sequence].

For a full list of ML techniques, readers are referred to appendix XX


In order to assess the predictive performance and find the optimal combination of hyperparameter configurations for each ML technique, I apply repeated K-fold cross-validation(CV). Briefly, CV involves splitting data into K partitions, usually denoted "folds", where each partition divides the full data into "training" and "testing" parts. The model is then fitted on the training portion of the data, and the fitted model is then used to predict the outcome in the test-portion of the data. The difference between these predictions and observed values in the test data is then used to measure predictive performance[@James_Witten_Hastie_Tibshirani_2021]. In my application, I use a 10-fold CV, which is repeated two times. I also use CV to tune the hyperparameters and select the opmtimal hyperparameter settings of the ML techniques. 
I will use Cohens Kappa as the primary metric for measuring the predictive performance of ML techniques, and select the ML technique and hyperparameter setting with the highest average Kappa value.

Cross-validation and fitting of all ML techniques were implemented using the "caret" package in R[@caret]



<!-- CV, or similar procedures, are crucial when assessing the predictive performance of ML techniques. For many of these techniques, the flexibility and complexity can be substantial and the techniques may overfit to data as a result, which skews measures of predictive performance in a positive direction. As such, CV functions as a general and non-parametric way of giving an unbiased estimate of predictive performance[@James_Witten_Hastie_Tibshirani_2021]. In that sense CV also serves as a standardized way of comparing techniques for which the internal workings differ greatly. In my application i use 10-fold CV, which is repeated 2 times. -->


```{tikz, cv-figure, fig.cap="Depiction of 5-fold CV, adapted from https://www.sharpsightlabs.com/wp-content/uploads/2024/02/cross-validation-explained_FEATURED-IMAGE.png", eval=FALSE}


\usetikzlibrary{matrix, positioning, calc}


\begin{tikzpicture}[scale=10]

    % Create the matrix
    \matrix (m) [matrix of nodes, 
        nodes in empty cells,
        row sep=1em, column sep=1em,
        nodes={draw, minimum width=2.5cm, minimum height=1cm, anchor=center, align=center},
        row 1/.style={font=\bfseries},
        column 1/.style={font=\bfseries},
        row 1 column 2/.style={text=black},
        row 1 column 3/.style={text=black},
        row 1 column 4/.style={text=black},
        row 1 column 5/.style={text=black},
        row 1 column 6/.style={text=black},
        column 1/.style={font=\bfseries},
        nodes={text depth=0pt,anchor=center}
        ] 
    {
        Iteration & Fold 1 & Fold 2 & Fold 3 & Fold 4 & Fold 5 \\ 
        Iter 1 & \textbf{\textcolor{magenta}{Test}} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & {$Performance_1$} \\
        Iter 2 & \textcolor{cyan}{Train} & \textbf{\textcolor{magenta}{Test}} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & {$Performance_2$} \\
        Iter 3 & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textbf{\textcolor{magenta}{Test}} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & {$Performance_3$} \\
        Iter 4 & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textbf{\textcolor{magenta}{Test}} & \textcolor{cyan}{Train} & {$Performance_4$} \\
        Iter 5 & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textcolor{cyan}{Train} & \textbf{\textcolor{magenta}{Test}} & {$Performance_5$} \\
    };
    
    % Arrows
    \foreach \i in {2,3,4,5,6}
    \draw[-stealth] (m-\i-6.east) -- ++(0.03,0) node[right, align=center] {};

    \node[draw, minimum width=2.5cm, minimum height=1cm, anchor=west, align=center, right=4.5cm of m-4-6.east] (avg) {$\frac{1}{k}\sum_{k=1}^k performance_k$};

    \foreach \i in {2,3,4,5,6}
    \draw[-stealth] (m-\i-7.east) -- (avg.west);


\end{tikzpicture}

```


<!-- Many ML techniques have several hyperparameters that impact the predictive performance, e.g., the degree of penalization of elastic net or the number of trees to aggregate in random forest. To pick the optimal combination of these hyperparameters for each technique, each technique will be fit, using CV, on a range of hyperparameter combinations. The hyperparameter combination with the best predictive performance will then be chosen. For models with few adjustable hyperparameters, I will use a "grid search" to assess all combinations of chosen hyperparameter values. For techniques with more adjustable hyperparameters, in this case, GBM, XGBoost, and random forest, I will pick 200 random hyperparameter combinations. Using random hyperparameter combinations is often an effective way to cover the search space of hyperparameter combinations, as opposed to doing a grid search which quickly results in thousands of hyperparameter combinations to asses in order to cover the hyperparameter search space adequately[@10.5555/2188385.2188395] -->



<!-- To measure the predictive performance, I will use Cohens Kappa, which is given by -->

<!-- \begin{equation}  -->
<!--   \kappa=\frac{p_0-p_t}{1-p_t} -->
<!--   (\#eq:kappa) -->
<!-- \end{equation} -->


<!-- In which $p_0$ is the proportion of agreements between predictions and observed values, while $p_t$ is the hypothetical proportion of agreement between predictions and observed values purely by chance. The kappa value ranges between 0 and 1, where 0 indicates that predictions and observed values are in no better agreement than what could be expected by chance. I have chosen Cohens Kappa as a measure of predictive performance, given that this measure is robust to "class imbalance", i.e., some categories of the outcome being much more prevalent than others. For instance, if the typology of career sequences is dominated by a single type in which 90% of teachers are assigned, then it would be easy to get 90% of predictions correct simply by predicting all teachers to be in the most prevalent type. The kappa value is robust to such a situation, however[@gong2021novel] -->




## Imputing school characteristics

Data on the school characteristics that comprise the scale used to construct the types of schools are, in many cases
plagued by missing data. This complicates analysis, as school types cannot be determined for some schools in some years. To alleviate this issue, I opted to impute data on school characteristics using linear regression. Data is imputed by fitting a model in which the school characteristic in question is predicted by an indicator for year and school fixed effects to account for variance between schools. To accommodate a non-linear time trend, the relation between $year_s$ and $School\ characteristic_{st}$ is fitted using a 5th-degree polynomial and a school fixed effect, $\alpha_s$.

$School\ characteristic_{st}=\beta_0+\beta_1 year_{t}+\beta_2 year^2_{t}+\beta_3 year^3_{t}+\beta_4 year^3_{t}+\beta_5 year^4_{t}+\beta_6 year^5_{t}+\alpha_s$


# Results

## Descriptive statistics

In the following, I will present descriptive statistics for both teachers and the types of schools.

### Teachers

Table \@ref(tab:des-teach) presents descriptive statistics for teachers in the first year since graduation. Statistics are presented across teacher "cohorts", which indicate the year each cohort graduated from teacher college.
The majority of teachers are unmarried, female, and do not have any children. Further, nearly all teachers are from the ethnic majority.
Importantly, table \@ref(tab:des-teach) also shows that the variable "number of children in household" does not cover before 1984. This is an important caveat in assessing the associations between teacher characteristics and types of teacher career paths, as i will apply listwise deletion for missing values. As such, the sample used for assessing associations between teacher characteristics and types of teacher career paths effectively does not include teachers from the 1980-1983 cohorts.

```{=latex}
\setlength{\LTpost}{0mm}
\begin{longtable}{p{3cm}p{1.5cm}p{1.5cm}p{1.5cm}p{1.5cm}p{1.5cm}p{1.5cm}p{1.5cm}}
\caption{Descriptive statistics for teachers}
    \label{tab:des-teach}\\
\toprule
\textbf{Characteristic} & \textbf{Overall}, N = 13,283\textsuperscript{\textit{1}} & \textbf{1980}, N = 2,533\textsuperscript{\textit{1}} & \textbf{1981}, N = 2,382\textsuperscript{\textit{1}} & \textbf{1982}, N = 2,342\textsuperscript{\textit{1}} & \textbf{1983}, N = 2,208\textsuperscript{\textit{1}} & \textbf{1984}, N = 2,114\textsuperscript{\textit{1}} & \textbf{1985}, N = 1,704\textsuperscript{\textit{1}} \\ 
\midrule\addlinespace[2.5pt]
age & 29 (5) & 29 (5) & 29 (5) & 29 (5) & 29 (5) & 29 (5) & 29 (5) \\ 
unmarried & 57\% & 51\% & 54\% & 55\% & 59\% & 62\% & 65\% \\ 
female & 58\% & 56\% & 57\% & 58\% & 58\% & 61\% & 62\% \\ 
number of children in household & 0.70 (2.25) & NA & NA & NA & NA & 0.75 (2.91) & 0.64 (0.90) \\ 
Unknown & 9,465 & 2,533 & 2,382 & 2,342 & 2,208 & 0 & 0 \\ 
Ethnic minority status &  &  &  &  &  &  &  \\ 
Born in Denmark & 99\% & 99\% & 98\% & 98\% & 99\% & 99\% & 99\% \\ 
Immigrant & 1.1\% & 1.0\% & 1.6\% & 1.2\% & 0.9\% & 1.1\% & 1.1\% \\ 
1st generation descendant of immigrants & 0.3\% & 0.2\% & 0.4\% & 0.4\% & 0.4\% & 0.1\% & 0.3\% \\ 
\bottomrule
\end{longtable}
\begin{minipage}{\linewidth}
\textsuperscript{\textit{1}}Mean (SD); n (\%)\\
\end{minipage}



```



```{r des stats teachers}

#cat(readLines("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_300624\\results\\sum_tab_schl.tex"))



```

### Schools

Table \@ref(tab:des-schools) presents descriptive results for the different types of schools. The average score of the school characteristics scale for each school type is reported in the bottom row. Here, we can see how school characteristics vary across school types, with parents in schools above the 75th percentile of the school characteristics scale having more than 20 months of additional education, on average, compared to schools between the 0th and 25th percentile for both mothers and fathers. The pattern is similar for the remaining school characteristics. 

```{=latex}
\setlength{\LTpost}{0mm}
\begin{longtable}{p{5.5cm}p{2.5cm}p{2.5cm}p{2.5cm}p{2.5cm}}
\caption{Descriptive statistics for schools}
    \label{tab:des-schools}\\
\toprule
\textbf{Characteristic} & \textbf{0-25\%}, N = 50,989\textsuperscript{\textit{1}} & \textbf{\textgreater{}25\%-50\%}, N = 54,236\textsuperscript{\textit{1}} & \textbf{\textgreater{}50\%-75\%}, N = 57,575\textsuperscript{\textit{1}} & \textbf{\textgreater{}75\%-100\%}, N = 52,460\textsuperscript{\textit{1}} \\ 
\midrule\addlinespace[2.5pt]
Average length of mothers education, in months & 145 (14) & 153 (12) & 157 (12) & 168 (13) \\ 
Average length of fathers education, in months & 150 (10) & 157 (8) & 162 (8) & 173 (10) \\ 
Average yearly disposable income of mothers in DKK & 139,876 (64,018) & 155,764 (63,249) & 156,520 (68,833) & 181,759 (92,592) \\ 
Average yearly disposable income of fathers in DKK & 146,979 (70,284) & 175,305 (71,828) & 184,225 (79,791) & 236,917 (139,759) \\ 
Proportion of students enrolled in secondary education the following year & 0.18 (0.08) & 0.22 (0.07) & 0.26 (0.08) & 0.37 (0.13) \\ 
Unknown & 131 & 81 & 166 & 11 \\ 
Proportion of students who are immigrants or descendants of immigrants & 0.15 (0.19) & 0.08 (0.10) & 0.06 (0.07) & 0.05 (0.06) \\ 
Avg. high school GPA of teachers & 79 (8) & 79 (8) & 80 (8) & 80 (8) \\ 
Unknown & 36,180 & 38,215 & 42,453 & 39,106 \\ 
Z-score of summed school characteristics & -4.4 (1.6) & -1.6 (0.6) & 0.6 (0.7) & 5.2 (3.4) \\ 
\bottomrule
\end{longtable}
\begin{minipage}{\linewidth}
\textsuperscript{\textit{1}}Mean (SD)\\
\end{minipage}


```



## Sequence analysis

In figure \@ref(fig:overall-seq-plot), we see the overall distribution of sequences for all teachers. While it is not surprising that the four different types of schools occupy roughly equal proportions of teacher career choices each year, it is somewhat surprising that the proportion of teacher graduates not working in a public primary school is very high. While the proportion of teachers outside public primary schools continues to decrease until the very late stages of teacher careers, the proportion is consistently above 50% of teachers until the late stages of teacher career paths.


```{r overall-seq-plot, fig.cap="Overall distribution of sequences"}

plot_dat <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\seqdplot_dat.txt", sep=",")


plot_dat$state <- factor(plot_dat$state, levels=c("0-25%", ">25%-50%", ">50%-75%", ">75%-100%", "Not teacher"))


ggplot(plot_dat, aes(x=x, y=value, fill=state, group=state))+geom_bar(stat="identity", color="black")+facet_wrap(~grouplab)+labs(x="Years since graduation", y="Proportion")

```




### Clustering sequences

This section will investigate how teacher career paths can be separated into different types of career paths using cluster analysis and the procedures described in the _methods_ section. As described, I will use the ASW measure to select the optimal number of clusters.

In table \@ref(tab:cluster-choice), we see that the ASW score is highest for the 4-cluster solution, and thus favors a solution with four clusters

```{r cluster-choice}

tab <- read.csv("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\clust_test.txt", check.names = FALSE)

rownames(tab) <- paste(2:7, "clusters")

tab <- tab["ASW"]

kab <- knitr::kable(tab, digits=2, caption="ASW score across numer of clusters")

kableExtra::kable_styling(kab, latex_options = "HOLD_position")

```



In figure \@ref(fig:cluster-seq-plot), we see the distributions of sequences across each of the four clusters. Following figure \@ref(fig:overall-seq-plot), it is perhaps not surprising that the decision to not work in a public primary school features prominently. However, in figure \@ref(fig:cluster-seq-plot), we see that the decision to not work in public primary school features heavily in a large group of teacher graduates who only rarely work in any type of public primary school during their entire career, here dubbed the "leavers" cluster. The two smallest clusters, cluster 2, "Teaching the marginalized" and cluster 3, "Teaching the affluent", contrast each other, given that the majority of teachers in cluster 3 work at schools at the upper end of the distribution of the school characteristics scale, while the opposite is true of teachers in cluster 2. Interestingly, teachers in Cluster 3 are more homogeneous in their choice of school than teachers in Cluster 2. While teachers in cluster 2, in contrast, work in the least advantaged schools, they also work in the schools between the >25th percentile and 50th percentile. The last cluster, cluster 4, here dubbed "all-round teachers", is more balanced, although the majority of teachers work in the "middle range" of school types.
While the proportion of teachers working outside public primary schools is similar in clusters 3 and 4, this proportion is generally larger for teachers in cluster 2, in the early career of teachers.

```{r cluster-seq-plot, fig.cap="Distribution of sequences across clusters"}

# knitr::include_graphics("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_300624\\results\\seq_plot_clusters.png")

plot_dat <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\seqdplot_clust_dat.txt", sep=",")

plot_dat$n_group <- as.numeric(stringr::str_extract(plot_dat$grouplab, "\\d{4}"))

plot_dat$sum <- sum(unique(plot_dat$n_group))

plot_dat$perc <- round(plot_dat$n_group/plot_dat$sum,2)

plot_dat$grouplab_new <- gsub("\\d{4}", plot_dat$perc, plot_dat$grouplab)

plot_dat$grouplab_new <- stringi::stri_replace_all_regex(plot_dat$grouplab, "n=\\d{4}", paste("share=",plot_dat$perc))

plot_dat$grouplab_new <- gsub("Cluster 1", "Cluster 1 - Leavers ", plot_dat$grouplab_new)

plot_dat$grouplab_new <- gsub("Cluster 2", "Cluster 2 - Teaching the marginalized ", plot_dat$grouplab_new)

plot_dat$grouplab_new <- gsub("Cluster 3", "Cluster 3 - Teaching the affluent ", plot_dat$grouplab_new)

plot_dat$grouplab_new <- gsub("Cluster 4", "Cluster 4 - All-round teachers ", plot_dat$grouplab_new)





plot_dat$state <- factor(plot_dat$state, levels=c("0-25%", ">25%-50%", ">50%-75%", ">75%-100%", "Not teacher"))


ggplot(plot_dat, aes(x=x, y=value, fill=state, group=state))+geom_bar(stat="identity", color="black")+facet_wrap(~grouplab_new)+labs(x="Years since graduation", y="Proportion")





```
The results shown in \@ref(fig:cluster-seq-plot) largely align with the theoretical expectation that teacher career paths are not completely heterogeneous. Indeed, teachers decisions to find employment at schools that serve student from different SES backgrounds can form the basis of a segmentation into different types of career paths. This segmentation is consistent with previous literature on teacher sorting, which points to students' social background as predictors of teacher attrition and retention. As such the results both suggest that there are groups of teachers that share similar career paths, and that the differences in career paths  between these groups can be expressed through their propensity to work in schools that serve students from different social backgrounds.

In contrast to expectations following the theoretical framework, none of the types of career paths shown in figure \@ref(fig:cluster-seq-plot) show noticeable signs of teacher career paths being particularly dynamic. For clusters 2,3 and 4 the only noticeable dynamic is that teachers transition from not teaching in public primary schools into teaching in one of the 4 types of schools during the first 15 years, until the trend flattens. Apart from this pattern, all teacher career paths are remarkably stable. We do not see, e.g. that teachers in cluster 2 begin their career in schools in the lowest end of the SES distribution and then transition towards schools that serve more affluent students as their careers progress. These stable patterns run counter to both theory and the existing literature. According to the theoretical framework, the continuous construction of teachers' professional identity should have given rise to more dynamic career paths. It would certainly be unexpected that teachers would have already formed a solid professional identity in early stages of their career, yet we do not see that teacher career are more or less dynamic at any stage in teachers' careers. The literature on teacher sorting consistently find that schools serving students from marginalized backgrounds have higher rates of teacher attrition. As such, we might expect that the share of teacher employed in schools serving student from marginalized backgrounds would be higher in the earlier stages of teachers' careers and that this share would get continuously smaller as teachers' careers progress. One might have expected to see a "stepping stone" type of pattern, in which teachers would progressively find employment in schools that served more and more affluent students as their careers progressed. We do not see anything resembling these kinds of patterns however. 

## Predicting clusters 

In this section, I will present the associations between teacher characteristics and the types of career paths presented in figure \@ref(fig:cluster-seq-plot). I will present a measure of variable importance of the best performing ML technique and choose the three most important variables for further interpretations. For results concerning the perfomance of different ML techniques, readers are referred to appendix XX.  To further investigate the association between the three most important variables and cluster membership, I will present these associations using "partial dependence plots"[@friedman2001greedy].

In addition to the teacher characteristics detailed in this paper's _data_ section, I also include two measures of "misclassification" regarding cluster membership. I include the silhouette width for each observation, which, as described, represents a measure of how well each career sequence fits within the assigned cluster compared to the "nearest neighbor" cluster. I also include an indicator for which cluster is the nearest neighbor. I include these to account for the correlation between misclassification and teacher characteristics. 

## Variable importance

This section will investigate the strength of the association between the included variables and cluster membership. While predictive performance was generally good for the best performing techniques, measures of variable importance suggest that measures of misclassification were far more predictive of cluster membership than teacher characteristics. Variable importance measures of advanced ML techniques are generally hard to interpret. I, therefore, use the predicted probabilities of cluster membership across a range of values of each teacher characteristic to construct an alternative measure of variable importance. Briefly, the measure is simply the difference between the lowest predicted probability of cluster membership and the highest predicted probability of cluster membership. For instance, if we predict the probability of membership to cluster 2 across a range of values of teacher high-school GPA, we may find that the lowest predicted probability is 12% at a value of 6.5, while the highest predicted probability is 20% at a value of 10.7. As such, teachers are maximally able to increase their probability of membership to cluster two by eight percentage points across high-school GPA. This difference is then averaged across the four clusters for each variable. This kind of measure of variable importance is similar to the suggestion of @greenwell, who suggests to use the standard deviation of the predicted values as a measure of variable importance. Both the measure suggested here, and that of @greenwell can be seen as measures of dispersion of the predicted values. However i will argue, that the difference between the minimum and maximum values are easier to interpret than the standard deviation. 

<!-- $importance=\frac{1}{c}\sum_{1}^{c}min(p)-max(p)$ -->

As we see in table \@ref(tab:varimp), the average difference between the highest and lowest predicted cluster membership probabilities is minimal. The results suggest that municipality type has the strongest association with cluster membership. Even so, the average maximum increase in the probability of cluster membership is 3.91 percentage points. The average maximum increase in predicted probability for the remaining teacher characteristics is less than half a percentage point. As such, all teacher characteristics show a weak association with cluster membership, and for 6 of the seven teacher characteristics, the association is negligible.

```{r, varimp}

varimp <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\varimp_pdp.txt", sep=",")

varimp$varimp <- varimp$varimp*100

names(varimp) <- c("Variable", "Importance")

varimp$Variable <- as.factor(varimp$Variable)

levels(varimp$Variable) <- c("Age at graduation", "Number of children in household", "Marital status", "Teacher high-school GPA", "Gender", "Municipality type","Year of graduation")

knitr::kable(varimp, digits=2, booktabs = T, caption = "Variable importance for included predictors")

```


### Interpreting associations between teacher characteristics and cluster membership

In this section, I will investigate the associations between cluster membership and municipality type, teachers' high school GPA, and age at graduation, as these were the three teacher characteristics with the strongest association with cluster membership. The associations are depicted in figure \@ref(fig:pdp-plots). To ease readability, I have scaled the predicted probabilities by subtracting the lowest predicted probability from each of the predicted probabilities within each cluster. For instance, for the association between age at graduation and membership to cluster 1, we see that the predicted probability is 0.4 percentage points higher than the lowest predicted probability at the peak of the curve, at around 30 years of age at the time of graduation.

The associations suggest that older teacher graduates are more likely to belong to clusters 1 and 3, suggesting that older graduates are more likely to belong to the clusters comprised of teachers who primarily work outside public primary schools or in schools serving students from more affluent backgrounds. Older teacher graduates may be more prone to have previous labor market experience. In that case, older teacher graduates may be more prone to be more selective in the labor market and may then be more prone to be selective in their choice of schools or to turn to alternatives outside public primary schools if they cannot find employment in schools that align with their preferences. 
For the association between teacher high-school GPA and cluster membership, it would be expected that teachers with better academic credentials would be more selective in their choice of schools or perhaps be more prone to seek employment outside public primary schools. However, it is surprising that teachers with higher high-school GPAs are more likely to be in Cluster 2, in which most teachers have careers in schools that serve less affluent students than in Cluster 3.
Regarding municipality type, we see signs of an urban/rural divide. By graduation, teachers who lived in a municipality in the capital region of Denmark are about 7% more likely to belong to cluster 3 than teachers who lived in a rural municipality. While the association is not as strong for membership to cluster 2, the association seems to be the opposite here, with teachers who lived in a rural municipality having the highest probability of membership. 




```{r pdp-plots, fig.cap="Partial dependence plots"}

pdp_files <- list.files("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824", pattern = "pdp_", full.names = TRUE)

pdp_files <- pdp_files[-grep("inter", pdp_files)]



pdp_plots <- lapply(1:length(pdp_files), function(x){
  
  file <- pdp_files[x]
  

  pdp_dat <- read.table(file, sep=",")
  
  pdp_dat$cluster <- gsub("_", " ", pdp_dat$cluster)
  
pdp_dat$cluster <- gsub("Cluster 1", "Cluster 1 - Leavers ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 2", "Cluster 2 - Teaching the marginalized ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 3", "Cluster 3 - Teaching the affluent ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 4", "Cluster 4 - All-round teachers ", pdp_dat$cluster)


lab <- unique(pdp_dat$var_name)

if (lab=="muni_type") {
  
  pdp_dat$var <- as.factor(pdp_dat$var)
  
  levels(pdp_dat$var) <- c("Capital", "Metropolitan", "Province", "Suburban", "Rural")
  
}

lab <- ifelse(lab=="age_at_grad", "age at graduation", 
       ifelse(lab=="KARAKTER_UDD_HS", "Teacher high-school GPA",
              ifelse(lab=="muni_type", "Municipality type", lab)))
if (lab!="Municipality type") {
p <- ggplot(pdp_dat, aes(x=var, y=yhat_scale))+geom_smooth(se=FALSE, color="black")+facet_wrap(~cluster, nrow=1)+labs(x=lab, y="Predicted probability scaled")
  
} else {
  
    p <- ggplot(pdp_dat, aes(x=var, y=yhat_scale))+geom_bar(stat="identity")+facet_wrap(~cluster, nrow=1)+labs(x=lab, y="Predicted probability scaled")+theme(axis.text.x = element_text(angle=90, vjust=.5))
}

if (x>1) {
  
  p <- p+theme(strip.text.x = element_blank())
}

return(p)
  
})

patchwork::wrap_plots(pdp_plots,nrow=3,ncol=1)+patchwork::plot_layout(axis_titles = "collect")



```

As mentioned in previous sections, many of the ML techniques I have used are capable, to some extent, of capturing interactions between variables. To display such interactions, I investigate whether predicted cluster membership probabilities vary across values of other teacher characteristics. Figure \@ref(fig:pdp-plots-inter) depicts the interactions between the three chosen teacher characteristics. Figure \@ref(fig:pdp-plots-inter) does not show much evidence that the same teacher characteristics might have substantial associations in other contexts. Instead, figure \@ref(fig:pdp-plots-inter) suggests that the association between age at graduation and cluster membership is as good as zero for teachers who lived in municipalities in the capital region.
Interestingly, the association between cluster membership and teachers' high-school GPA seems to be mainly isolated to teachers who lived in municipalities in the capital region. Despite these differences in associations across different contexts, the associations remain weak. As such, teacher characteristics do not seem more important in any of the contexts presented than the average importance of teacher characteristics.

```{r pdp-plots-inter, fig.cap="Partial dependence plots for interactions"}

pdp_files <- list.files("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824", pattern = "pdp_", full.names = TRUE)

pdp_files <- pdp_files[grep("inter", pdp_files)]

pdp_plots <- lapply(1:length(pdp_files), function(x){
  
  #x <- 1

  file <- pdp_files[x]
  
  pdp_dat <- read.table(file, sep=",")
  

  pdp_dat$cluster <- gsub("_", " ", pdp_dat$cluster)
  
    pdp_dat$cluster <- gsub("Cluster 1", "Cluster 1 - Leavers ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 2", "Cluster 2 - Teaching the marginalized ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 3", "Cluster 3 - Teaching the affluent ", pdp_dat$cluster)

pdp_dat$cluster <- gsub("Cluster 4", "Cluster 4 - All-round teachers ", pdp_dat$cluster)
  
  lab_1 <- unique(pdp_dat$var_name_x)
  
  
  lab_2 <- unique(pdp_dat$var_name_y)


  
  lab <- ifelse(lab_1=="age_at_grad", "age at graduation", 
       ifelse(lab_1=="KARAKTER_UDD_HS", "Teacher high-school GPA",
              ifelse(lab_1=="muni_type", "Municipality type", lab_1)))
  
  col_lab <- ifelse(lab_2=="age_at_grad", "age at graduation", 
       ifelse(lab_2=="KARAKTER_UDD_HS", "Teacher high-school GPA",
              ifelse(lab_2=="muni_type", "Municipality type", lab_2)))
  
  if (lab_1=="muni_type") {
  
  pdp_dat$var <- as.factor(pdp_dat$var)
  
  levels(pdp_dat$var) <- c("Capital", "Metropolitan", "Province", "Suburban", "Rural")
  
  }
  
  
    if (lab_2=="muni_type") {
  
  pdp_dat$va2 <- as.factor(pdp_dat$va2)
  
  levels(pdp_dat$va2) <- c("Capital", "Metropolitan", "Province", "Suburban", "Rural")
  
}
  
  if(lab_1=="muni_type"){
    
    p <- ggplot(pdp_dat, aes(x=var2, y=yhat_scale, color=var, group=var))+geom_smooth(se=FALSE)+facet_wrap(~cluster, nrow=1)+labs(x=col_lab, y="Predicted probability scaled", color=lab)
    
  } else {

  p <- ggplot(pdp_dat, aes(x=var, y=yhat_scale, color=var2, group=var2))+geom_smooth(se=FALSE)+facet_wrap(~cluster, nrow=1)+labs(x=lab, y="Predicted probability scaled", color=col_lab)
  
  }
  
  if (x>1) {
  
  p <- p+theme(strip.text.x = element_blank())
}

  
  return(p)
  
})
  



patchwork::wrap_plots(pdp_plots,nrow=3,ncol=1)+patchwork::plot_layout(axis_titles = "collect", guides="collect")


```


<!-- ## Robustness checks -->

<!-- - Missing data -->
<!--   - unbalanced panel -->
<!--   - attrition -->
<!--   - missing school data -->
<!--    - imputing school data -->
<!--    - imputing sequences -->


<!-- - Confounders -->

<!-- - sensitivity -->
<!--   -sensitivity to distance metrics -->
<!--   -sensitivity to clustering method -->





# Discussion


# Why do so many teachers choose not to teach in public primary schools?

While it is initially surprising that more than half of teacher graduates never teach in public primary schools, similar shares of teacher college graduates opt out of teaching in the US and the UK[@shields2018valuing]. In that sense, the attrition rates in Denmark are seemingly similar to those of other OECD countries. 
The literature on teacher attention and attrition, as well as the work of Carol Rinke, frequently mention negative experiences while working as a teacher as reasons for opting out of teaching, e.g., poor work environment, lack of support and mentoring, exhaustion, etc. However, this paper's results point to most teachers opting out immediately after graduating. As such, nearly half of teacher college graduates never once worked in a public primary school during their career. While neither the literature nor theory addresses teacher graduates who never enter teaching public primary schools after graduation, teacher graduates will have some experience working as a teacher while doing internships as a part of attaining their degree. In Denmark, school internships are an integrated part of a teacher college degree, and teacher students typically take part in an internship at least one day a week. As such, teacher graduates would have had limited experience working as teachers and experience with the work environment at a school before they graduate. This limited experience likely plays a role in forming students' perception of success in their careers after graduating, and for many students, this perception may not involve a career in teaching in public primary schools at all. 

While the results may give the perception that the majority of teacher college graduates complete a 4-year college degree in teaching and then choose a career in which they do anything but work in teaching, this is likely not the case. While the majority of teacher college graduates opt out of public primary schools, they may seek employment at private primary schools or other educational institutions, e.g., schools for special needs children. In other words, one should not interpret the results to mean that teacher colleges attract students who do not wish to work in teaching. On the other hand, the share of private primary school students in Denmark was less than 20% until 2014(https://www.vive.dk/media/pure/18924/17712909). Similarly, around 11% of teachers work in private primary schools, as mentioned earlier. While teacher graduates attain strong skills in disseminating knowledge, pedagogy, and subject matter knowledge, teacher colleges focus on competency in primary school teaching. Thus, It is unlikely that a large share of teacher graduates would find employment in secondary or tertiary education. In sum, while some teacher graduates who never taught in public primary schools are likely to teach in other kinds of educational institutions, particularly private primary schools, it is unlikely that this is the case for all of these teacher graduates. Thus, a substantial portion of teacher college graduates likely never engage in any kind of teaching.

 - Teachers may find employment in private schools or in other positions in the teaching sector
 
 - Some may pursue post-graduation education
 
 - Economic situation and declining fertility in the 80's may have lessened demand for teachers and resources to hire.

## Why are teacher characteristics not more strongly associated with types of career paths?

Another surprising result is the lack of predictive power of the chosen teacher characteristics, even when using methods that can accommodate very complex associations. While the teacher characteristics chosen here only comprise a subset of possible teacher characteristics that likely impact teacher career decisions, both the literature on teacher attrition and retention and the theoretical framework suggest that these characteristics should be noticeably associated with teacher career decisions. There are a range of likely reasons why we do not find any substantial association between these teacher characteristics and teacher career paths.

First and foremost, teacher characteristics are measured at the time of graduation, and these measurements are then subsequently expected to predict the teachers' entire careers. While these measurements may be predictive of career decisions early in teachers' careers, it is unlikely that these measurements should predict career decisions at later stages in teachers' careers. As detailed in the theoretical framework, the formation of teachers' professional identity is taken to be a continuous process in which present experiences as a teacher are filtered through experiences in teachers' past. However, one may argue that experiences related to working in teaching become increasingly important to future career decisions as such experiences accrue. Thus, one might argue that the characteristics of teachers at the time of graduation are essential to early career decisions of teachers, but that the importance of these early career characteristics may dilute as teacher careers progress. This is especially true for teacher characteristics such as the number of children and marital status. Unlike, e.g., high school GPA, these characteristics are not constant across time, which is not accommodated in the modeling procedure. Further, most college graduates are not married and do not have children. As such, while marital status and the number of children likely play a role in teacher career decisions, they are also likely to be more important later in teachers' careers than at the time of graduation. 

Secondly, teachers’ high school GPA is likely not the best indicator of teachers' skills. It would likely have been better to use a more direct measurement of teacher skill, e.g., an estimate of teachers' value-added score, which assesses teachers' ability to improve students' academic performance. However, measures of students' academic performance do not cover earlier than 2005 in the data available through Statistics Denmark, and it is therefore not possible to estimate teachers' value-added scores. Another improvement would have been to use teachers' college GPA, as teachers' college GPA is a more direct assessment of how well teachers possess skills relevant to primary school teaching.  

<!-- - High school GPA may be poor choice of academic credentials, college GPA would be better. Teachers' ability to teach would be even better -->

<!-- - Teacher characteristics measured at time of graduation may not be very predictive of entire career paths. Perhaps having children in the middle of a career is much more predictive of the remaining career than having children at the time of graduation is of the entire career -->

<!-- - Predicting typers of teacher careers, based on cluster analysis, likely involves both measurement error and misclassification -->

## How might teacher career path patterns impact teachers' distribution among high- and low-SES students?

While the scholarly literature on teacher sorting and teacher mobility suggests that teachers sort out of schools that serve students from low-SES backgrounds and that more skilled teachers are less prone to find employment in these schools, I do not find such patterns in teacher career paths in this paper. Instead, the results suggest that teacher career paths are remarkably stable across the entirety of teacher careers. While the results suggest that teacher career paths can be segmented by which type of public primary school they work in, results do not suggest that teachers within these types of career paths differ systematically in a range of characteristics. Further, all types of career paths show similar stability. As such, teachers who have chosen to teach in schools serving students from low-SES backgrounds are transitioning to schools serving students from other SES backgrounds as their careers progress. Rather, the results suggest that teachers "stay in their lane" from when they graduate and throughout their careers. 

<!-- Given the patterns of career paths, how would teachers be distributed among different types of schools at different stages of teacher careers? -->
<!-- -How do these distributions differ among teacher with different characteristics? -->

<!-- # External validity -->

<!-- Teacher career paths and their typologies differ substantially across teacher graduate cohorts. This likely suggests that teacher career paths are influenced by general societal conditions, e.g. fertility rates, the state of the economy, the state of the labor market for teachers etc., at play during the time the teachers are participating in the labor market and, perhaps especially so, when teachers graduate. As such the results presented here may not generalize to societal contexts that are very different from the one that is featured in this paper. -->

<!-- ## Policy implications -->

<!-- Should efforts to retain teachers be focused on early- or late-carreer teachers?  -->

# Conclusion

The results presented in this paper suggest that teacher career paths can be meaningfully segmented according to the average SES status of the schools in which they are employed. In summary, teacher career paths can be segmented into four types of career paths:

1) In the first type of career path, in which the majority of teacher graduates are placed, teacher graduates are primarily employed outside of public primary schools.

2) In the second type of career path, the majority of teachers are employed in schools serving students from low-SES backgrounds

3) In the third type of career path, the majority of teachers are employed in schools serving students from high-SES background

4) The fourth type of career path is mainly populated by teachers employed in public primary schools that serve students from middle-SES backgrounds 

All types of career paths showed nearly no signs of transitions between categories of schools and only moderate transitions between being employed outside public primary school and categories of public primary schools. In other words, teacher graduates, regardless of their type of career path, tend to work in the same type of public primary school or opt out of public primary schools from the beginning to the end of their career. 

In this paper, I have used flexible machine learning methods to investigate whether the type of municipality that teachers lived in, the number of children in the household, marital status, and age, all measured at the time of graduation, as well as teachers' high-school GPA, gender and year of graduation could predict which types of career paths teachers would fall in. The results suggest that the type of municipality teachers lived in, teachers' high-school GPA and teachers' age at graduation were the most predictive characteristics of the type of career path. However, even the most predictive teacher characteristics were weakly associated with types of career paths. For the most predictive teacher characteristic, the type of municipality, the average difference between the largest and smallest predicted probability of cluster membership across clusters was less than four percentage points. 

While it may initially be surprising that around 50% of teacher graduates choose not to work in public primary schools at any point in their teacher career, these results align with results from other OECD countries. In contrast, according to the theoretical framework applied in this paper, teachers' career paths should have exhibited more dynamic patterns of career choices, given that teachers' professional identity is depicted as the result of a dynamic process across the careers of teachers. Similarly, according to the theoretical framework and the literature on teacher attrition/retention, the characteristics of teachers included in this paper should have been more predictive of teacher career paths.

As such, these results suggest that the effort to combat teacher shortages and unfavorable teacher sorting should be focused on:

1) The substantial share of teachers that never teach in public primary schools
2) The early career of teachers, as teacher careers seem to be "locked" in on the type of school teachers will teach in, or whether they will choose not to teach in public primary school, from the early stages of teacher careers.



<!-- - A surprisingly large proportion of teachers do not work in public primary schools.  -->

<!-- - Despite this, the proportion of teachers workin in public primary schools keeps rising as time passes. This suggests that a minority of teacher graduates do "opt in" to teaching in public primary schools continously during the course of teachers' careers -->

<!-- - The career paths of teachers can be divided into 4 broad types of career paths. The majority of teachers fall into the type of career path in which teacher graduates almost exclusively work outside public primary schools. Two types of career paths contrast each other, as one type of career path generally involves teachers that work in schools that primarily serve affluent students, while the opposite is the case of the other type of career path. The last type of career path sees teachers' being more or less equally distributed across the remaining two types of schools that which position themselves above the 25th and below the 75th percentile of the school characteristics scale.  -->

<!-- - Teacher characteristics, measured at the time of graduation, are very poor predictors of which type of career path teachers follow -->



# Appendix

## List of ML techniques




I will use the following approaches to investigate the associations between teacher characteristics and types of career sequences: 

<!-- ChatGPT used here -->

* Multinomial logistic regression[@nnet]

* Elastic net regression[@enet]

<!-- Elastic net regression is a type of penalized regression, where regression coefficients are "penalized" according to an amount specified by the user. Elastic net combines both L1- and L2-penalization according to a "mixing weight" which controls the proportion of penalization that is attributed to either L1 or L2 penalization. Elastic Net can handle scenarios with highly correlated features and can perform better than linear regression by reducing overfitting and improving generalization. Elastic net is implemented via the "glmnet" package in R -->


* Decision Tree[@rpart]

<!-- A decision tree is a flowchart-like model that splits data into subsets based on variable values, leading to a tree structure. RPART (Recursive Partitioning and Regression Trees) is an implementation in R. -->
<!-- Decision trees can capture non-linear relationships and interactions between features, regardless of whether these are specified or not. While this ability of decision trees is not guaranteed to automatically find the true functional form of relationships or all interactions between variables, this ability may still lead to improvements over multinomial regression.Decision trees are implmented via the "rpart" package in R -->

* Conditional Inference Tree (ctree)[@ctree]

<!-- A conditional inference tree is a type of decision tree that uses statistical tests to select splits rather than greedy algorithms. It controls for overfitting by stopping the tree when splits are not statistically significant. -->
<!-- By focusing on statistically significant splits, ctrees reduce the risk of overfitting and can model complex interactions. This may be an improvement over traditional implementations of decision trees, which are prone to overfitting. -->

* Support Vector Machine (SVM)[@svm]

<!-- SVM is a classification and regression algorithm that finds the hyperplane that best separates data points into different classes. It can handle both linear and non-linear data using kernel functions. -->
<!-- SVM is particularly effective in high-dimensional spaces and can capture complex, non-linear relationships, offering better performance in cases where linear regression would be insufficient. SVM has proven highly effective in other practical applications. -->

* K-Nearest Neighbors (KNN)[@nnet]


<!-- KNN is a simple, non-parametric algorithm that predicts the outcome by averaging the values of the k nearest data points in the feature space. -->
<!-- KNN can model non-linear relationships without making assumptions about the data distribution, potentially outperforming multinomial regression, especially in cases with complex patterns. -->

* Multivariate Adaptive Regression Splines(MARS)[@earth]

<!-- Known as MARS, this method builds flexible models by creating piecewise linear regressions over different intervals of the data. Similar to decision trees, MARS has the ability to capture unspecified interactions between variables. MARS is a regression approach at its core however, and may therefore be better suited to model continous predictors than decision trees. MARS is implemented via the "earth" package in R.  -->

* Gradient Boosted Trees (GBM)[@gbm]

<!-- GBM is an ensemble technique that builds multiple decision trees sequentially, each trying to correct the errors of the previous ones. -->
<!-- GBM can model intricate patterns and interactions in the data by combining the strengths of multiple weak learners (decision trees). As such, gradient boosted trees improve upon approaches that use a single decision tree. -->

* Extreme Gradient Boosting (XGBoost)[@xgboost]

<!-- XGBoost is an optimized implementation of gradient boosting that is highly efficient, flexible, and portable, often used in machine learning competitions. XGboost is an extension upon GBM, which is intitially due it's optimized implementation, which reduces computing time. However XGboost also features other extensions, e.g. additional hyperparameters, that may lead to better predictive performance. -->

* Random Forest[@ranger]

<!-- Random Forest is an ensemble learning method that builds multiple decision trees and combines their predictions to improve accuracy and control overfitting. -->
<!-- By averaging the predictions from various decision trees, Random Forest reduces variance, can handle large datasets with higher dimensionality, and can capture non-linear relationships. While random forests are initially an improvement upon single decision trees, random forests have shown to deliver good predictive performance even when compared with more advanced machine learning techniques, such as GBM and XGboost. -->

For further information on either of the ML techniques, readers are referred to [@James_Witten_Hastie_Tibshirani_2021]

<!-- The list of machine learning techniques i have chosen here are often among the techniques that deliver the best predictive performance when dealing with ordered and tablular data, as is the case here. Conversely, while neural networks have shown to outperform all the techniques listed above in the presence of unordered data, e.g. text or images, neural networks often show, at best, a predictive performance that is comparable to the techniques presented above. As such, i have chosen not investigate whether neural networks may provide better predictive performance than multinomial regression, as these types of machine learning techniques typically require a large amount of computing time.  -->


## Observed transition rates and substitution costs

In table \@ref(tab:trate) the observed transition probabilities between states is shown, and in table \@ref(tab:cost) the cost associated with each type of substitution is shown. The insertion and deletion costs are both 1.

```{r, trate}

trate <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\trate.txt", sep=",")

names(trate) <- gsub("->", "", rownames(trate))

kab <- knitr::kable(trate, digits=2, caption = "Observed transition rates between states")

kableExtra::kable_styling(kab, latex_options = "HOLD_position")


```

```{r, cost}

costs <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\costs.txt", sep=",")

costs <- costs[,2:ncol(costs)]

names(costs) <- rownames(costs)

kab <- knitr::kable(costs, digits=2, caption = "Substitution cost matrix")

kableExtra::kable_styling(kab, latex_options = "HOLD_position")


```


## Results of PCA

Table \@ref(tab:scale-qual) shows that the first principal component accounts for 72% of the variance among the chosen school characteristics. As such, expanding the scale to include additional principal components would likely substantially increase complexity to account for a relatively small amount of variance. 

```{r scale-qual}

tab <- read.csv("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_010724\\pca_res.txt")

kab <- knitr::kable(tab, digits=2, caption = "Summary of principal components analysis of school characteristics")

kableExtra::kable_styling(kab, latex_options = "HOLD_position")

```




## Performance of ML models

In figure \@ref(fig:ml-perf), we see that GBM achieved the highest performance, although the predictive performance of GBM is close to that of other tree-based techniques. While the performance of GBM is better than techniques based on linear regression, the differences in kappa-values are not large. While the first quartile of GBM is higher than the third quartile of multinomial regression, this is not true when compared to elastic net performance. 

```{r, ml-perf}

ml_res <- read.table("C:\\Users\\b059064\\Desktop\\PHD\\papers\\teacher career paths\\results_from_dst\\Transfer_708877_140824\\ml_res.txt", sep=",")

ml_res <- ml_res[c(1,grep("Kappa", names(ml_res)))]

names(ml_res) <- gsub("Kappa", "", names(ml_res))


ml_res_long <- melt(ml_res, id.vars = "Resample")


ml_res_long$variable <- gsub("\\.", "", ml_res_long$variable)

pat <- paste(c("gbm$", "gbm_h20", "gbm_h20_rand", "svmrad", "xgb_dart"), collapse="|")

ml_res_long <- ml_res_long[-grep(pat, ml_res_long$variable),]

ml_res_long$variable <-as.factor(ml_res_long$variable )

levels(ml_res_long$variable) <- c("Ctree", "MARS", "Elastic net", "GBM", "KNN", "Multinomial regression",
                                  "Random forest", "Decision tree", "SVM", "XGBoost")

#agg <- aggregate(ml_res_long$value, list(ml_res_long$variable), quantile)


ggplot(ml_res_long, aes(value, reorder(variable,value)))+geom_boxplot()+labs(y="ML technique", x="Average kappa value")

```


# Bibliography
